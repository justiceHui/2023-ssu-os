# 설계과제 #4 - SSU Memory Allocation and Multi-level File System

### 과제 목표

* xv6 메모리 및 파일 시스템 구조 이해와 응용

### 1. (구현) 가상 메모리 페이지 할당

* 가상 메모리 할당을 위한 `ssualloc()` 시스템 콜 구현
  * 할당할 가상 메모리의 크기(양수, 페이지 크기의 배수)를 인자로 받음
  * 유효하지 않은 값 입력 시 -1 반환
  * 유효한 값을 받아서 가상 메모리를 성공적으로 할당하면 할당한 메모리의 주소 반환
  * `ssualloc()`은 물리 메모리가 아닌 가상 메모리만 할당
    * 사용자가 할당된 가상 메모리에 접근 시, 해당 가상 메모리에 대응되는 물리 메모리가 존재하지 않으면 `trap`에서 물리 메모리 페이지 할당해야 함
    * 1개 초과의 가상 메모리 페이지 할당 시, 접근된 페이지에 대해서만 물리 메모리 페이지 생성
* 메모리 정보 확인을 위한 `getvp()`, `getpp()` 시스템 콜 구현
  * `getvp()`는 호출된 프로세스에 할당된 가상 메모리 페이지 개수 반환
  * `getpp()`는 호출된 프로세스에 할당된 물리 메모리 페이지 개수 반환
* `ssualloc_test`를 이용해 실행 확인
  * 제공되는 `ssualloc_test.c` 코드를 **수정하지 않고** 그대로 사용

### 2. (구현) multi-level 파일 시스템 구현

* 파일 시스템 수정
  * 기존 xv6 파일 시스템에서 사용하는 inode의 구조
    * 12개의 direct block (`addrs[0]` ~ `addrs[11]`)
    * 1개의 indirect block (`addrs[12]`)
    * 한 파일에서 140 = 12 + 128개의 데이터 블록 사용 가능
    * 한 파일의 최대 크기는 140 * 512Bytes ~= 70KB
  * 목표
    * 6개의 direct block (`addrs[0]` ~ `addrs[5]`)
    * 4개의 indirect block (`addrs[6]` ~ `addrs[9]`)
    * 2개의 2-level indirect block (`addrs[10]` ~ `addrs[11]`)
    * 1개의 3-level indirect block (`addrs[12]`)
    * 한 파일에서 2130438개의 데이터 블록 사용 가능, 최대 약 1GB
  * 대용량 파일 생성을 위해 `params.h`의 `FSSIZE`를 1000에서 2500000으로 변경
* `ssufs_test`를 이용해 실행 확인
  * 제공되는 `ssufs_test.c` 코드를 **수정하지 않고** 그대로 사용

### 배점

1. 50점(필수)
2. 50점(필수)